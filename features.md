ТЕХНИЧЕСКОЕ ЗАДАНИЕ (Окончательная структурированная версия)

### I. ОБЩИЕ ТРЕБОВАНИЯ ДЛЯ ОБОИХ БОТОВ

Фича 1: Система напоминаний о бронировании
1.  Функционал:
    *   Бот автоматически отправляет пользователю напоминание о предстоящей брони за 24 часа до её начала.
    *   Вместе с напоминанием приходит кнопка "Настройки напоминаний".
2.  Управление настройками:
    *   В "Настройках напоминаний" пользователь может включать/выключать уведомления.
    *   По умолчанию: напоминание включено.
    *   Интеграция в меню: В разделе пользователя "Мои заявки" добавить кнопку для быстрого включения/выключения напоминаний (рядом со списком заявок).

Фича 2: Ежемесячный аудит и экспорт данных
1.  Формирование отчета:
    *   Когда: Первого числа каждого месяца.
    *   Кому: Отправляется в чат менеджеру.
    *   Формат: Файл XLS (Excel).
    *   Содержание: Выгрузка данных из всех таблиц базы данных каждого бота.
    *   Структура файла: Каждая таблица — на отдельном листе внутри одного XLS-файла.
    *   Именование файла: {МЕСЯЦ}_{ГОД}.xls (например, `Январь_2024.xls`).
2.  Политика хранения данных:
    *   Заявки старше 31 дня автоматически удаляются из базы данных. Причина: ограничение хранения.

Фича 3: Система управления доступом (общая)
*   Оба бота должны иметь:
    *   Список заблокированных пользователей (чёрный список).
    *   Список менеджеров с правами администратора.

---

### II. ТРЕБОВАНИЯ ДЛЯ ПЕРВОГО БОТА (Бронирование аппаратов)

Фича 1: Управление аппаратами и интеграция для второго бота
1.  Резервирование аппаратов:
    *   Менеджер может отметить определенные аппараты как "забронированные на вечную аренду" для нужд второго бота.
2.  API (Эндпоинты) для интеграции со вторым ботом:
    *   `GET /api/devices`: Возвращает список всех доступных аппаратов (с учётом "вечной аренды").
    *   `POST /api/book-device`: Позволяет второму боту выполнить проверку доступности и бронирование конкретного аппарата на указанную дату и время. Возвращает статус (успех/неудача).

---

### III. ТРЕБОВАНИЯ ДЛЯ ВТОРОГО БОТА (Бронирование кабинетов)

Фича 1: Гибкое управление рабочим расписанием
1.  Расписание по умолчанию:
    *   Время работы: с 10:00 до 22:00.
    *   Обеденный перерыв: отсутствует (по умолчанию).
2.  Функционал для менеджера:
    *   Возможность изменить дежурное (стандартное) расписание.
    *   Возможность задать время обеда в стандартном расписании.
    *   Возможность установить особое расписание на конкретные даты (например, выходной, сокращенный рабочий день).
3.  Важное ограничение:
    *   Запрещено изменять расписание на дату/время, на которое уже есть неперенесенные активные заявки. Сначала все заявки должны быть перенесены или отменены.

Фича 2: Диалог бронирования для пользователя (структура)
1.  Сбор данных клиента:
    *   Бот последовательно запрашивает: ФИО, желаемую дату и время бронирования.
2.  Выбор длительности:
    *   Минимальный слот (пул): 30 минут.
    *   Пользователь должен иметь возможность выбрать несколько последовательных слотов (например, 2 слота = 1 час, 3 слота = 1.5 часа).
3.  Выбор аппарата:
    *   Бот получает от Первого бота (через `GET /api/devices`) актуальный список доступных аппаратов и предлагает его пользователю для выбора.
4.  Проверка и подтверждение:
    *   Проверяется доступность кабинета в выбранное время.
    *   Проверяется доступность выбранного аппарата через вызов POST /api/book-device к Первому боту.
    *   Если оба условия выполнены — создается заявка. До одобрения менеджером время считается условно занятым.
5.  Информационное сообщение:
    *   В диалоге должно быть предупреждение, что окончательное подтверждение зависит от звонка менеджера и доступности аппаратов.

Фича 3: Расширенный функционал для менеджера второго бота
Менеджер в админ-интерфейсе/чате должен иметь возможность по любой заявке:
1.  Редактировать параметры:
    *   Перенести заявку на другую дату/время.
    *   Увеличить или уменьшить количество забронированных слотов.
    *   Изменить тип/конкретный аппарат в заявке (из доступного списка).
2.  Управление статусами:
    *   Согласовать (одобрить) заявку.
    *   Отклонить заявку.
    *   Вернуть на доработку пользователю с комментарием для изменения деталей.

Фича 4: Конфигурация и интеграция
1.  Настройка при запуске:
    *   Количество кабинетов для бронирования настраивается при запуске/деплое бота.
2.  Внешние интеграции:
    *   Интеграция с Google Таблицами (для выгрузки/синхронизации данных, детали уточняются).
    *   Интеграция с Первым ботом через предоставленные API-эндпоинты.