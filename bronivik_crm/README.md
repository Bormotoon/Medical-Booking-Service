# Bronivik CRM Bot

> üìö **–û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: [README](../README.md) | [English](../README.en.md)

Telegram-–±–æ—Ç –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–æ–≤ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å [Bronivik Jr](../bronivik_jr/README.md).

–ß–∞—Å—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã [Medical Booking Service](../README.md) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.

## –û–±–∑–æ—Ä

Bronivik CRM ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä–µ–Ω–¥–æ–π –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –ø–æ —á–∞—Å–∞–º. –ü—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ API –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ Bronivik Jr, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ü–æ—á–∞—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∫–∞–±–∏–Ω–µ—Ç–∞
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è**: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–ø–ø–∞—Ä–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ API Bronivik Jr
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã**: —Ñ–æ–Ω–æ–≤–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite (–∏–Ω—Ç–µ—Ä–≤–∞–ª 24—á, TTL 14 –¥–Ω–µ–π)
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å**: —É–¥–æ–±–Ω—ã–π –≤—ã–±–æ—Ä –¥–∞—Ç—ã —á–µ—Ä–µ–∑ –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏**: —Å–±–æ—Ä –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- **–ü–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞**: –±—ã—Å—Ç—Ä–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫
- **Redis-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–µ—Ä–µ–∑ API
- **Prometheus –º–µ—Ç—Ä–∏–∫–∏**: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.22+
- SQLite3
- Redis 7+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
- –î–æ—Å—Ç—É–ø –∫ API Bronivik Jr (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/Bormotoon/bronivik_crm.git
cd bronivik_crm
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
cp .env.example .env
```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
CRM_BOT_TOKEN=your_telegram_bot_token
CRM_API_KEY=your_api_key
CRM_API_EXTRA=your_extra_key
MANAGERS=123456789
```

3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `configs/config.yaml`

### –ó–∞–ø—É—Å–∫ —Å Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker compose up -d --build
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- `bronivik-crm-bot`: –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (–ø–æ—Ä—Ç 8090 –¥–ª—è health check)
- `bronivik-crm-redis`: Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod download

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
go run ./cmd/bot

# –ò–ª–∏ —Å–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
make build
./bin/bronivik-crm
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
bronivik_crm/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ bot/          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ configs/          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ bot/          # –õ–æ–≥–∏–∫–∞ Telegram –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ crmapi/       # HTTP-–∫–ª–∏–µ–Ω—Ç –¥–ª—è Bronivik Jr API
‚îÇ   ‚îú‚îÄ‚îÄ db/           # –†–∞–±–æ—Ç–∞ —Å SQLite (–∫–∞–±–∏–Ω–µ—Ç—ã, –±—Ä–æ–Ω–∏)
‚îÇ   ‚îú‚îÄ‚îÄ metrics/      # Prometheus –º–µ—Ç—Ä–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ model/        # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ Makefile
```

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `/book` ‚Äî –Ω–∞—á–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - –í—ã–±–æ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞
  - –í—ã–±–æ—Ä –∞–ø–ø–∞—Ä–∞—Ç–∞ (–∏–ª–∏ "–ë–µ–∑ –∞–ø–ø–∞—Ä–∞—Ç–∞")
  - –í—ã–±–æ—Ä –¥–∞—Ç—ã
  - –í—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
  - –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω)
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏
- `/my_bookings` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- `/cancel_booking <ID>` ‚Äî –æ—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

### –ö–æ–º–∞–Ω–¥—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞

- `/pending` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫, –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- `/today_schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
- `/tomorrow_schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
- `/add_cabinet <name>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç
- `/list_cabinets` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤
- `/set_schedule <cab_id> <day> <start> <end>` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã `configs/config.yaml`:

```yaml
telegram:
  bot_token: ${CRM_BOT_TOKEN}  # –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞

api:
  base_url: "http://localhost:8080"  # URL API Bronivik Jr
  api_key: ${CRM_API_KEY}
  api_extra: ${CRM_API_EXTRA}
  cache_ttl_seconds: 300  # TTL –∫—ç—à–∞ Redis

booking:
  min_advance_minutes: 60    # –ú–∏–Ω–∏–º—É–º –∑–∞ —á–∞—Å –¥–æ –Ω–∞—á–∞–ª–∞
  max_advance_days: 30       # –ú–∞–∫—Å–∏–º—É–º 30 –¥–Ω–µ–π –≤–ø–µ—Ä—ë–¥
  max_active_per_user: 0     # 0 = –±–µ–∑ –ª–∏–º–∏—Ç–∞

managers:  # Telegram ID –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
  - 123456789

monitoring:
  prometheus_enabled: true
  prometheus_port: 9090
  health_check_port: 8090
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Bronivik Jr

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç REST API –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

- `GET /api/v1/items` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
- `GET /api/v1/availability/{name}?date=YYYY-MM-DD` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- `POST /api/v1/availability/bulk` ‚Äî –º–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: –∑–∞–≥–æ–ª–æ–≤–∫–∏ `x-api-key` –∏ `x-api-extra`

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –û—Ç—á—ë—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
make test-coverage

# –õ–∏–Ω—Ç–∏–Ω–≥
make lint

# –°–±–æ—Ä–∫–∞
make build

# –û—á–∏—Å—Ç–∫–∞
make clean
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Health Check**: `http://localhost:8090/healthz`
- **Readiness Check**: `http://localhost:8090/readyz`
- **Prometheus Metrics**: `http://localhost:9090/metrics` (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

SQLite —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º —Ä–µ–∂–∏–º–æ–º WAL (Write-Ahead Logging) –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `users` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ Telegram
- `cabinets` ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–∞–±–∏–Ω–µ—Ç—ã
- `cabinet_schedules` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–∞–±–∏–Ω–µ—Ç–æ–≤
- `hourly_bookings` ‚Äî –ø–æ—á–∞—Å–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

- GitHub: [Bormotoon](https://github.com/Bormotoon)
- –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–µ–∫—Ç: [Bronivik Jr](https://github.com/Bormotoon/bronivik_jr)

