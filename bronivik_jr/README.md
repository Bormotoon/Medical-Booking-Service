# Bronivik Jr

> üìö **–û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: [README](../README.md) | [English](../README.en.md)

–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ –ø–æ–ª–Ω—ã–π –¥–µ–Ω—å.

–ß–∞—Å—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã [Medical Booking Service](../README.md), –∫–æ—Ç–æ—Ä–∞—è —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞–µ—Ç [Bronivik CRM](../bronivik_crm/README.md) –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–æ–≤.

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å Google Sheets, SQLite (WAL) –∏ Redis.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Bronivik Jr (Core Service)

- **Telegram Bot**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.
- **REST API & gRPC**: –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–≤ —Ç.—á. CRM –±–æ—Ç–∞).
- **SQLite (WAL)**: –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (–±—Ä–æ–Ω–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ).
- **Google Sheets Worker**: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±—Ä–æ–Ω–µ–π —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ Google.
- **Event Bus**: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —à–∏–Ω–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.
- **Redis**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ (Rate Limiting).

### 2. Bronivik CRM (Cabinet Booking)

- **Telegram Bot**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤.
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞ —á–µ—Ä–µ–∑ API Bronivik Jr.
- **SQLite**: –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –∏ –ø–æ—á–∞—Å–æ–≤—ã—Ö –±—Ä–æ–Ω–µ–π.

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.24+
- SQLite3
- Redis 7+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- Google Cloud Service Account (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets)

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å (`configs/config.yaml`)

```yaml
app:
  name: "bronivik-go"
  environment: "staging"
  version: "1.0.0"

telegram:
  bot_token: ${BOT_TOKEN}
  debug: true

database:
  path: "./data/bookings.db"

google:
  credentials_file: ${GOOGLE_CREDENTIALS_FILE}
  bookings_spreadsheet_id: ${BOOKINGS_SPREADSHEET_ID}

api:
  enabled: true
  grpc_port: 8081
  http:
    enabled: true
    port: 8080
  auth:
    enabled: true
    keys: ["KEY1", "KEY2"]
```

### –°–ø–∏—Å–æ–∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è (`configs/items.yaml`)

–í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, –∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ:

```bash
cp .env.example .env
```

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- `BOT_TOKEN`: –¢–æ–∫–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞.
- `CRM_BOT_TOKEN`: –¢–æ–∫–µ–Ω CRM –±–æ—Ç–∞.
- `CRM_API_KEY`: –ö–ª—é—á –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ CRM -> Jr.
- `GOOGLE_CREDENTIALS_FILE`: –ü—É—Ç—å –∫ JSON-—Ñ–∞–π–ª—É —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Google Cloud.

---

## –ó–∞–ø—É—Å–∫

### Docker Compose (–ª—É—á—à–∏–π —Å–ø–æ—Å–æ–±)

```bash
docker compose up -d --build
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:

- `booking-bot`: –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç.
- `booking-api`: gRPC (8081) + HTTP (8080) API.
- `bronivik-crm-bot`: CRM –±–æ—Ç (8090).
- `booking-redis`: Redis —Å–µ—Ä–≤–µ—Ä.

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
go run ./cmd/bot --config=configs/config.yaml

# API —Å–µ—Ä–≤–∏—Å
go run ./cmd/api --config=configs/config.yaml

# CRM –±–æ—Ç
go run ./bronivik_crm/cmd/bot --config=bronivik_crm/configs/config.yaml
```

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–æ–≤

### Bronivik Jr (–û—Å–Ω–æ–≤–Ω–æ–π)

- `/start` ‚Äî –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã.
- `/book` ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∞—Å—Ç–µ—Ä –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.
- `/my_bookings` ‚Äî –°–ø–∏—Å–æ–∫ –º–æ–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π.
- `/cancel_booking <ID>` ‚Äî –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏.

**–ú–µ–Ω–µ–¥–∂–µ—Ä—ã (Jr):**

- `/approve <ID>` ‚Äî –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å.
- `/stats` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥.
- `/export_bookings` ‚Äî –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets.

### Bronivik CRM

- `/start` ‚Äî –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã.
- `/book` ‚Äî –í—ã–±–æ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞, –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ (—Å–ª–æ—Ç–∞).
- `/my_bookings` ‚Äî –ú–æ–∏ –∑–∞–ø–∏—Å–∏ –≤ –∫–∞–±–∏–Ω–µ—Ç—ã.
- `/cancel_booking <ID>` ‚Äî –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏.

**–ú–µ–Ω–µ–¥–∂–µ—Ä—ã (CRM):**

- `/pending` ‚Äî –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–¥–ø–∏—Å—å.
- `/today_schedule` ‚Äî –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –∫–∞–±–∏–Ω–µ—Ç–∞–º –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Prometheus Metrics**: `http://localhost:9090/metrics`
- **Health Checks (Jr API)**: `http://localhost:8080/healthz`
- **Health Checks (CRM)**: `http://localhost:8090/healthz`

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
make test          # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test-coverage # –û—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
make lint          # –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–∞ (golangci-lint)
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã (REST)

- `GET /api/v1/items` ‚Äî –°–ø–∏—Å–æ–∫ –≤—Å–µ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.
- `GET /api/v1/availability/{item_name}?date=YYYY-MM-DD` ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–∞ –¥–∞—Ç—É.
- `POST /api/v1/availability/bulk` ‚Äî –ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.

### Google Sheets Worker

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î (—Å–æ–∑–¥–∞–Ω–∏–µ, –æ—Ç–º–µ–Ω–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –≤–æ—Ä–∫–µ—Ä–æ–º. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Google API –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Telegram.

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –≤ —Ä–µ–∂–∏–º–µ **WAL (Write-Ahead Logging)**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ—Ç—É –∏ API –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–∞–∑–æ–π –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ú–ü–õ 2.0
